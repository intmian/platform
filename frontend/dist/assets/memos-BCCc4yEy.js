import{r as t,I as S,_ as w,j as i,S as j,B as v,T as z,a as H,b as L}from"./index-XfME8XLE.js";var O={icon:function(e,s){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:e}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm193.4 225.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.3 0 19.9 5 25.9 13.3l71.2 98.8 157.2-218c6-8.4 15.7-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.4 12.7z",fill:s}},{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z",fill:e}}]}},name:"check-circle",theme:"twotone"},B=function(e,s){return t.createElement(S,w({},e,{ref:s,icon:O}))},q=t.forwardRef(B),$={icon:function(e,s){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:e}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm171.8 527.1c1.2 1.5 1.9 3.3 1.9 5.2 0 4.5-3.6 8-8 8l-66-.3-99.3-118.4-99.3 118.5-66.1.3c-4.4 0-8-3.6-8-8 0-1.9.7-3.7 1.9-5.2L471 512.3l-130.1-155a8.32 8.32 0 01-1.9-5.2c0-4.5 3.6-8 8-8l66.1.3 99.3 118.4 99.4-118.5 66-.3c4.4 0 8 3.6 8 8 0 1.9-.6 3.8-1.8 5.2l-130.1 155 129.9 154.9z",fill:s}},{tag:"path",attrs:{d:"M685.8 352c0-4.4-3.6-8-8-8l-66 .3-99.4 118.5-99.3-118.4-66.1-.3c-4.4 0-8 3.5-8 8 0 1.9.7 3.7 1.9 5.2l130.1 155-130.1 154.9a8.32 8.32 0 00-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3 99.3-118.5L611.7 680l66 .3c4.4 0 8-3.5 8-8 0-1.9-.7-3.7-1.9-5.2L553.9 512.2l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z",fill:e}}]}},name:"close-circle",theme:"twotone"},A=function(e,s){return t.createElement(S,w({},e,{ref:s,icon:$}))},N=t.forwardRef(A),J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"},V=function(e,s){return t.createElement(S,w({},e,{ref:s,icon:J}))},D=t.forwardRef(V),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512.5 390.6c-29.9 0-57.9 11.6-79.1 32.8-21.1 21.2-32.8 49.2-32.8 79.1 0 29.9 11.7 57.9 32.8 79.1 21.2 21.1 49.2 32.8 79.1 32.8 29.9 0 57.9-11.7 79.1-32.8 21.1-21.2 32.8-49.2 32.8-79.1 0-29.9-11.7-57.9-32.8-79.1a110.96 110.96 0 00-79.1-32.8zm412.3 235.5l-65.4-55.9c3.1-19 4.7-38.4 4.7-57.7s-1.6-38.8-4.7-57.7l65.4-55.9a32.03 32.03 0 009.3-35.2l-.9-2.6a442.5 442.5 0 00-79.6-137.7l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.2 28.9c-30-24.6-63.4-44-99.6-57.5l-15.7-84.9a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52-9.4-106.8-9.4-158.8 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.3a353.44 353.44 0 00-98.9 57.3l-81.8-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a445.93 445.93 0 00-79.6 137.7l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.2 56.5c-3.1 18.8-4.6 38-4.6 57 0 19.2 1.5 38.4 4.6 57l-66 56.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.3 44.8 96.8 79.6 137.7l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.8-29.1c29.8 24.5 63 43.9 98.9 57.3l15.8 85.3a32.05 32.05 0 0025.8 25.7l2.7.5a448.27 448.27 0 00158.8 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-84.9c36.2-13.6 69.6-32.9 99.6-57.5l81.2 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.5-87.4 79.6-137.7l.9-2.6c4.3-12.4.6-26.3-9.5-35zm-412.3 52.2c-97.1 0-175.8-78.7-175.8-175.8s78.7-175.8 175.8-175.8 175.8 78.7 175.8 175.8-78.7 175.8-175.8 175.8z"}}]},name:"setting",theme:"filled"},K=function(e,s){return t.createElement(S,w({},e,{ref:s,icon:F}))},P=t.forwardRef(K),G={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},U=function(e,s){return t.createElement(S,w({},e,{ref:s,icon:G}))},Y=t.forwardRef(U);function _(o){const e=t.useCallback(()=>{o()},[o]);t.useEffect(()=>(window.addEventListener("blur",e),()=>{window.removeEventListener("blur",e)}),[e])}const{TextArea:Q}=L;let T=null;function E(o,e,s,r,f,a){if(T&&new Date().getTime()-T.getTime()<1e3){confirm("发送过于频繁，请稍后再试"),a();return}else T=new Date;let n="";r.length>0&&(n="#"+r.join(" #"));const u={content:s+`
`+n,visibility:"PRIVATE"},c=5e3,h=new AbortController,p=setTimeout(()=>h.abort(),c);fetch(o+"/api/v1/memos",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(u),signal:h.signal}).then(d=>{if(clearTimeout(p),!d.ok)throw new Error(`HTTP error! Status: ${d.status}`);return d.json()}).then(d=>{d.content?f():a()}).catch(d=>{console.error("Error:",d),a()})}function W(o,e,s,r){fetch(o+"/api/v1/memos/-/tags",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}).then(f=>f.json()).then(f=>{if(f.tagAmounts){const a=f.tagAmounts,n=[];for(const[c,h]of Object.entries(a))n.push({tag:c,amount:h});n.sort((c,h)=>h.amount-c.amount);const u=n.map(c=>c.tag);s({tags:u})}})}function X({reqs:o,url:e,apiKey:s}){const[r,f]=t.useState(new Map),a=(u,c)=>{const h=new Map(r);h.set(u,c),f(h)},n=[];for(const u of o){const c=u.id;let h=!1;r.has(c)||(h=!0,r.set(c,{finish:!1,success:!1}));const p=r.get(c);if(!p)continue;h&&(a(c,{finish:!1,success:!1}),E(e,s,u.content,u.tags,()=>{a(c,{finish:!0,success:!0})},()=>{a(c,{finish:!0,success:!1})}));const d=u.content+(u.tags.length>0?`
 #`+u.tags.join(" #"):"");p.finish?p.success?n.push(i.jsx(z,{title:d,children:i.jsx(q,{twoToneColor:"#52c41a"})},u.id)):n.push(i.jsx(N,{twoToneColor:"#ff8b8b",title:d,onClick:()=>{E(e,s,u.content,u.tags,()=>{a(c,{finish:!0,success:!0})},()=>{a(c,{finish:!0,success:!1})}),a(c,{finish:!1,success:!1})}},u.id)):n.push(i.jsx(z,{title:d,children:i.jsx(Y,{style:{color:"orange"},spin:!0})},u.id))}return i.jsx(j,{style:{border:"1px dashed",borderRadius:"10px",padding:"2px",width:"100%",boxSizing:"border-box",paddingLeft:"5px",paddingRight:"5px"},children:n})}function Z({TagsChange:o,setting:e,style:s,tags:r}){const f=JSON.parse(localStorage.getItem("memosTags")||"[]"),a=t.useRef(f);return t.useEffect(()=>{W(e.url,e.key,n=>{a.current=n.tags,localStorage.setItem("memosTags",JSON.stringify(a.current))})},[e.url,e.key,o]),i.jsx(H,{onChange:n=>{o(n)},tags:r,style:s,tagOps:a.current,disabled:!1,maxTagCount:void 0,maxTagTextLength:void 0,maxTagPlaceholder:void 0})}function ee({functionsRef:o,style:e,onChange:s}){const[r,f]=t.useState(""),a=t.useRef(""),n=t.useRef(null),u=t.useCallback(()=>{f(""),a.current=""},[]),c=t.useCallback(()=>{let m=0;for(let g=0;g<r.length&&r[g]==="*";g++)m++;return a.current.slice(0,m)+r.slice(m)},[r]),h=t.useCallback(()=>{a.current=r,f("*".repeat(r.length))},[r]),p=t.useCallback(()=>{let m=0;for(let g=0;g<r.length&&r[g]==="*";g++)m++;f(a.current.slice(0,m)+r.slice(m))},[r]),d=t.useCallback(()=>{n.current&&n.current.focus()},[]);return t.useImperativeHandle(o,()=>({clear:u,get:c,hide:h,show:p,focus:d}),[u,d,c,h,p]),t.useEffect(()=>{s(c())},[c,s,r]),i.jsx(Q,{ref:n,autoFocus:!0,style:e,value:r,onChange:m=>f(m.target.value),placeholder:`Enter换行
Ctrl+Enter发送
tab切换标签输入`})}function ne(){const o=JSON.parse(localStorage.getItem("memosSetting")||"{}"),e=t.useRef(o);if(!o.url||!o.key){let l=prompt("请输入备忘录的URL");l&&!l.includes("http")&&(l="https://"+l);const x=prompt("请输入备忘录的KEY");e.current?(l&&(e.current.url=l),x&&(e.current.key=x)):e.current={url:l||"",key:x||""},localStorage.setItem("memosSetting",JSON.stringify(e.current))}const s=i.jsx(v,{size:"small",shape:"circle",icon:i.jsx(D,{}),onClick:()=>{const l=prompt("请输入备忘录的URL");l&&(e.current.url=l),localStorage.setItem("memosSetting",JSON.stringify(e.current))}}),r=i.jsx(v,{size:"small",shape:"circle",icon:i.jsx(P,{}),onClick:()=>{const l=prompt("请输入备忘录的KEY");l&&(e.current.key=l),localStorage.setItem("memosSetting",JSON.stringify(e.current))}}),[f,a]=t.useState(!1),n=t.useRef({clear:()=>{},get:()=>"",hide:()=>{},show:()=>{},focus:()=>{}}),[u,c]=t.useState(!1),h=i.jsx(ee,{functionsRef:n,style:{marginBottom:"10px",flexGrow:1,fontSize:"16px"},onChange:l=>{c(e.current.url!==""&&e.current.key!==""&&l!=="")}});_(()=>{n.current.get()!==""&&!f&&(n.current.focus(),a(!0),n.current.hide())});const p=Math.floor(Math.random()*1e6),[d,m]=t.useState(p),[g,I]=t.useState([]),y=t.useRef(g),k=t.useCallback((l,x)=>{y.current=[{content:l,tags:x,id:d},...g],y.current.length>10&&y.current.pop(),I(y.current)},[d,g]),[C,R]=t.useState([]),b=t.useCallback(()=>{const l=n.current.get();k(l,C),n.current.clear(),m(d+1),a(!1),R([]),n.current&&n.current.focus()},[k,d,C]);t.useEffect(()=>{const l=x=>{x.ctrlKey&&x.key==="Enter"&&(x.stopPropagation(),b())};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[b]);const M=t.useCallback(l=>{R(l)},[]);return i.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f5f5f5"},children:i.jsxs("div",{style:{width:"400px",height:"400px",margin:"20px",backgroundColor:"white",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)",borderRadius:"10px",padding:"20px",boxSizing:"border-box",display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{display:"flex",marginBottom:"10px"},children:[i.jsx("div",{style:{width:"90%",marginRight:"10px"},children:i.jsx(X,{reqs:g,url:e.current.url,apiKey:e.current.key})}),i.jsxs(j,{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"15%",height:"100%"},children:[s,r]})]}),h,i.jsxs("div",{style:{display:"flex"},children:[i.jsx(Z,{TagsChange:M,tags:C,setting:e.current,style:{flexGrow:1,marginRight:"10px"}}),i.jsxs(j,{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx(v,{onClick:()=>{f?n.current.show():n.current.hide(),a(!f)},children:f?"显示":"隐藏"}),i.jsx(v,{type:"primary",disabled:!u,onClick:b,children:"发送"})]})]})]})})}export{ne as default};
